<!-- {{ pastObstericHistoryForm.value | json }} -->
<div class="row m-t-10 text-right">
  <p class="font-history-label m-t-10">
    {{
      currentLanguageSet?.historyData?.obstetrichistory?.previousObstetricHist
    }}
  </p>
  <button
    type="button"
    mat-icon-button
    matTooltip="{{ currentLanguageSet?.DurationData?.previousDetails }}"
    id="previousANCPastObstetricHistory"
    class="pull-right"
    color="primary"
    (click)="getPreviousObstetricHistory()"
  >
    <mat-icon class="md-18">history</mat-icon>
  </button>
</div>
<div class="row" [formGroup]="pastObstericHistoryForm">
  <div class="col-xs-12 col-sm-4 box">
    <mat-form-field class="input-full-width">
      <input
        autocomplete="off"
        matInput
        defaultNull
        placeholder="{{
          currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
            ?.totalNumberofPregnancies
        }}"
        name="totalNoOfPreg "
        allowText="number"
        allowMax="10"
        [attr.readonly]="visitCategory === 'ANC' ? 'readonly' : null"
        formControlName="totalNoOfPreg"
        (blur)="checkTotalPregnancy(totalNoOfPreg)"
      />
    </mat-form-field>
  </div>

  <div class="col-xs-12 col-sm-6" *ngIf="totalNoOfPreg > 0">
    <p class="control-label">
      {{
        currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
          ?.orderofPregnancy
      }}
    </p>
    <div class="clearfix"></div>
    <div class="checkbox-group" formArrayName="complicationPregList">
      <ng-container
        *ngFor="
          let number of getComplicationPregList();
          let i = index;
          trackBy: trackComplication
        "
        [formGroupName]="i"
      >
        <mat-checkbox
          formControlName="value"
          class="checkbox"
          color="primary"
          (change)="togglePastObstericHistory($event, i + 1)"
        >
          {{ i + 1 }}
        </mat-checkbox>
      </ng-container>
    </div>
  </div>

  <div class="col-xs-12" formArrayName="pastObstericHistoryList">
    <mat-card
      class="row"
      *ngFor="
        let pastObstericHistory of getPastObstericHistoryList();
        let i = index
      "
    >
      <ng-container [formGroupName]="i">
        <mat-card-content>
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
            <mat-form-field class="input-full-width">
              <input
                autocomplete="off"
                matInput
                defaultNull
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.number
                }}"
                name="pregOrder"
                formControlName="pregOrder"
                [readonly]="true"
              />
            </mat-form-field>
          </div>

          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
            <mat-select
              class="select-full-width"
              name="complicationDuringPregnancy"
              formControlName="pregComplicationList"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.complicationduringPregnancy
              }}"
              (change)="
                resetOtherPregnancyComplication(pastObstericHistory, i, true)
              "
              multiple
            >
              <ng-container
                *ngFor="let complication of masterData?.pregComplicationTypes"
              >
                <mat-option
                  [value]="complication"
                  [disabled]="
                    !complicationOptionConstraints[i].showAllPregComplication &&
                    ((complication?.pregComplicationType === 'None' &&
                      complicationOptionConstraints[i]
                        ?.disableNonePregnancyComplication) ||
                      (complication?.pregComplicationType !== 'None' &&
                        !complicationOptionConstraints[i]
                          .disableNonePregnancyComplication))
                  "
                >
                  {{ complication.pregComplicationType }}
                </mat-option>
              </ng-container>
            </mat-select>
          </div>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              complicationOptionConstraints[i]?.showOtherPregnancyComplication
            "
          >
            <mat-form-field class="input-full-width">
              <input
                autocomplete="off"
                matInput
                defaultNull
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.others
                }}"
                allowText="alphaspace"
                maxlength="50"
                name="others"
                formControlName="otherPregComplication"
              />
            </mat-form-field>
          </div>

          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
            <mat-select
              class="select-full-width"
              name="outcomeOfPregnancy"
              formControlName="pregOutcome"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.outcomeofpregnancy
              }}"
              (change)="checkPregnancyOutcome(pastObstericHistory)"
            >
              <mat-option
                *ngFor="let outcome of masterData?.pregOutcomes"
                [value]="outcome"
              >
                {{ outcome.pregOutcome }}
              </mat-option>
            </mat-select>
          </div>

          <ng-container
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome === 'Abortion'
            "
          >
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
              <mat-select
                class="select-full-width"
                name="typeOfAbortion"
                formControlName="abortionType"
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.typeOfAbortion
                }}"
                [required]="
                  pastObstericHistory.value.pregOutcome?.pregOutcome ===
                  'Abortion'
                "
              >
                <mat-option
                  *ngFor="let abortion of masterData?.typeOfAbortion"
                  (click)="
                    onAbortionType(
                      pastObstericHistory,
                      abortion.complicationValue
                    )
                  "
                  [value]="abortion"
                >
                  {{ abortion.complicationValue }}
                </mat-option>
              </mat-select>
            </div>
            <div
              class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
              *ngIf="
                pastObstericHistory.value.abortionType?.complicationValue ===
                'Induced'
              "
            >
              <mat-select
                class="select-full-width"
                name="typeofFacility"
                formControlName="typeofFacility"
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.typeofFacility
                }}"
                [required]="
                  pastObstericHistory.value.pregOutcome?.pregOutcome ===
                    'Abortion' &&
                  pastObstericHistory.value.abortionType?.complicationValue ===
                    'Induced'
                "
              >
                <mat-option
                  *ngFor="let type of masterData?.serviceFacilities"
                  [value]="type"
                >
                  {{ type.facilityName }}
                </mat-option>
              </mat-select>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
              <mat-form-field class="input-full-width">
                <input
                  autocomplete="off"
                  (change)="checkDurationType(pastObstericHistory)"
                  matInput
                  placeholder="{{
                    currentLanguageSet?.historyData?.opd_NCD_PNCHistory
                      ?.obstetric?.noOfcompletedWeeks
                  }}"
                  name="durationOfType"
                  allowText="number"
                  formControlName="pregDuration"
                  [required]="
                    pastObstericHistory.value.pregOutcome?.pregOutcome ===
                    'Abortion'
                  "
                />
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
              <mat-select
                class="select-full-width"
                name="complicationPostAbortion"
                formControlName="postAbortionComplication"
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.complicationPostAbortion
                }}"
                (change)="resetPostComplicationType(pastObstericHistory, i)"
                multiple
                [required]="
                  pastObstericHistory.value.pregOutcome?.pregOutcome ===
                  'Abortion'
                "
              >
                <mat-option
                  *ngFor="
                    let complicationAbortion of masterData?.postAbortionComplications
                  "
                  [disabled]="
                    !complicationOptionConstraints[i].showAllPostComplication &&
                    ((complicationAbortion?.complicationValue === 'None' &&
                      complicationOptionConstraints[i]
                        ?.disableNonePostComplication) ||
                      (complicationAbortion?.complicationValue !== 'None' &&
                        !complicationOptionConstraints[i]
                          .disableNonePostComplication))
                  "
                  [value]="complicationAbortion"
                >
                  {{ complicationAbortion.complicationValue }}
                </mat-option>
              </mat-select>
            </div>
          </ng-container>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome !== 'Abortion'
            "
          >
            <mat-select
              class="select-full-width"
              name="durationOfPregnancy"
              formControlName="durationType"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.durationofPregnancy
              }}"
              (change)="hrpPastObstetricDetails(true)"
            >
              <mat-option
                *ngFor="let duration of masterData?.pregDuration"
                [value]="duration"
              >
                {{ duration.durationType }}
              </mat-option>
            </mat-select>
          </div>

          <ng-container
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome !== 'Abortion'
            "
          >
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
              <mat-select
                class="select-full-width"
                name="placeOfDelivery"
                formControlName="deliveryPlace"
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.placeofDelivery
                }}"
                (change)="resetOtherDeliveryPlace(pastObstericHistory)"
              >
                <mat-option
                  *ngFor="let place of masterData?.deliveryPlaces"
                  [value]="place"
                >
                  {{ place.deliveryPlace }}
                </mat-option>
              </mat-select>
            </div>

            <div
              class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
              *ngIf="
                pastObstericHistory.value.deliveryPlace?.deliveryPlace ===
                'Other'
              "
            >
              <mat-form-field class="input-full-width">
                <input
                  autocomplete="off"
                  matInput
                  defaultNull
                  placeholder="{{
                    currentLanguageSet?.historyData?.opd_NCD_PNCHistory
                      ?.obstetric?.others
                  }}"
                  maxlength="50"
                  allowText="alphaspace"
                  name="otherPlaceOfDelivery"
                  formControlName="otherDeliveryPlace"
                />
              </mat-form-field>
            </div>
          </ng-container>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome !== 'Abortion'
            "
          >
            <mat-select
              class="select-full-width"
              name="typeOfDelivery"
              formControlName="deliveryType"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.deliveryType
              }}"
              [disabled]="!pastObstericHistory.value.deliveryPlace"
              (change)="hrpPastObstetricDetails(true)"
            >
              <ng-container *ngFor="let type of selectDeliveryTypes">
                <mat-option [value]="type">
                  {{ type.deliveryType }}
                </mat-option>
              </ng-container>
            </mat-select>
          </div>

          <ng-container
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome !== 'Abortion'
            "
          >
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
              <mat-select
                class="select-full-width"
                name="deliveryComplication"
                formControlName="deliveryComplicationList"
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.deliveryComplication
                }}"
                (change)="
                  resetOtherDeliveryComplication(pastObstericHistory, i, true)
                "
                multiple
              >
                <ng-container
                  *ngFor="
                    let complication of masterData?.deliveryComplicationTypes
                  "
                >
                  <mat-option
                    class="mat-option"
                    [value]="complication"
                    [disabled]="
                      !complicationOptionConstraints[i]
                        .showAllDeliveryComplication &&
                      ((complication?.deliveryComplicationType === 'None' &&
                        complicationOptionConstraints[i]
                          ?.disableNoneDeliveryComplication) ||
                        (complication?.deliveryComplicationType !== 'None' &&
                          !complicationOptionConstraints[i]
                            .disableNoneDeliveryComplication))
                    "
                  >
                    {{ complication.deliveryComplicationType }}
                  </mat-option>
                </ng-container>
              </mat-select>
            </div>

            <div
              class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
              *ngIf="
                complicationOptionConstraints[i]?.showOtherDeliveryComplication
              "
            >
              <mat-form-field class="input-full-width">
                <input
                  autocomplete="off"
                  matInput
                  defaultNull
                  placeholder="{{
                    currentLanguageSet?.historyData?.opd_NCD_PNCHistory
                      ?.obstetric?.others
                  }}"
                  maxlength="50"
                  allowText="alphaspace"
                  name="othersDeliveryComplication"
                  formControlName="otherDeliveryComplication"
                />
              </mat-form-field>
            </div>
          </ng-container>

          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box">
            <mat-select
              class="select-full-width"
              name="postpartumComplication"
              formControlName="postpartumComplicationList"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.postpartumComplication
              }}"
              (change)="
                resetOtherPostpartumComplicationType(pastObstericHistory, i)
              "
              multiple
            >
              <ng-container
                *ngFor="
                  let complication of masterData?.postpartumComplicationTypes
                "
              >
                <mat-option
                  class="mat-option"
                  [value]="complication"
                  [disabled]="
                    !complicationOptionConstraints[i]
                      .showAllPostpartumComplication &&
                    ((complication?.postpartumComplicationType === 'None' &&
                      complicationOptionConstraints[i]
                        ?.disableNonePostpartumComplication) ||
                      (complication?.postpartumComplicationType !== 'None' &&
                        !complicationOptionConstraints[i]
                          .disableNonePostpartumComplication))
                  "
                >
                  {{ complication.postpartumComplicationType }}
                </mat-option>
              </ng-container>
            </mat-select>
          </div>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              complicationOptionConstraints[i]?.showOtherPostpartumComplication
            "
          >
            <mat-form-field class="input-full-width">
              <input
                autocomplete="off"
                matInput
                defaultNull
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.others
                }}"
                maxlength="50"
                allowText="alphaspace"
                name="otherPostpartumComplication"
                formControlName="otherPostpartumCompType"
              />
            </mat-form-field>
          </div>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome ===
              'Live Birth'
            "
          >
            <mat-select
              class="select-full-width"
              name="newBornComplications"
              formControlName="newBornComplication"
              placeholder="{{
                currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                  ?.newBornComplication
              }}"
              (change)="resetOtherNewBornComplications(pastObstericHistory)"
            >
              <mat-option
                *ngFor="let complication of masterData?.newBornComplications"
                [value]="complication"
              >
                {{ complication.complicationValue }}
              </mat-option>
            </mat-select>
          </div>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              pastObstericHistory.value.newBornComplication
                ?.complicationValue === 'Other'
            "
          >
            <mat-form-field class="input-full-width">
              <input
                autocomplete="off"
                matInput
                defaultNull
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.others
                }}"
                maxlength="50"
                allowText="alphaspace"
                name="otherNewBornComplication"
                formControlName="otherNewBornComplication"
              />
            </mat-form-field>
          </div>

          <div
            class="col-xs-12 col-sm-6 col-md-4 col-lg-4 box"
            *ngIf="
              pastObstericHistory.value.pregOutcome?.pregOutcome ===
              'Live Birth'
            "
          >
            <mat-form-field class="input-full-width">
              <input
                autocomplete="off"
                matInput
                defaultNull
                placeholder="{{
                  currentLanguageSet?.historyData?.opd_NCD_PNCHistory?.obstetric
                    ?.congenitalAnomalies
                }}"
                maxlength="50"
                allowText="alphaspace"
                name="congenitalAnomalies"
                formControlName="congenitalAnomalies"
                (change)="setCongenitalAnomalies()"
              />
            </mat-form-field>
          </div>
        </mat-card-content>
      </ng-container>
    </mat-card>
  </div>
</div>
